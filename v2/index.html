<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple widget embedded - Clicksign</title>
    <!-- <script>
      (() => {
        var Clicksign = class {
          constructor(key) {
            this.key = key;
            this.origin = window.location.protocol + '//' + window.location.host;
            this.listen = {};
            this.endpoint = 'https://app.clicksign.com';
            this.allowPermissions = 'camera;geolocation;fullscreen;gyroscope;accelerometer;magnetometer';
            this.iframeStyle = 'width: 100%; height: 100%;';
            this.target = null;
            this.iframe = null;
          }

          eventsFor(event) {
            var name = event.name || (event.data && event.data.name) || event.data || event;
            return this.listen[name] || [];
          }

          eventHandler = (event) => {
            var handlers = this.eventsFor(event);
            for (var i = 0; i < handlers.length; i++) {
              handlers[i](event.data);
            }
          }

          mount(elementId) {
            this.target = document.getElementById(elementId);
            if (!this.target) {
              console.warn('Target element not found');
              return;
            }

            this.iframe = document.createElement('iframe');
            this.iframe.setAttribute('src', this.source);
            this.iframe.setAttribute('style', this.iframeStyle);
            this.iframe.setAttribute('allow', this.allowPermissions);
            window.addEventListener('message', this.eventHandler);
            this.target.appendChild(this.iframe);
          }

          on(eventName, callback) {
            if (!this.listen[eventName]) {
              this.listen[eventName] = [];
            }
            this.listen[eventName].push(callback);
          }

          unmount() {
            if (this.iframe && this.target) {
              this.target.removeChild(this.iframe);
              window.removeEventListener('message', this.eventHandler);
              this.iframe = null;
              this.target = null;
            }
            return true;
          }

          get source() {
            return this.endpoint + this.path + this.params;
          }

          get params() {
            return '?embedded=true&origin=' + encodeURIComponent(this.origin);
          }

          get path() {
            return '/notarial/compat/requests/' + this.key;
          }
        };

        window.Clicksign = Clicksign;
      })();
    </script> -->
    <!-- <script src="https://cdn-public-library.clicksign.com/embedded/embedded.min-2.0.0.js"></script> -->
     <!-- Versão Buildada do projeto embedded local -->
      <script>
        (()=>{var m=Object.defineProperty;var l=(i,t)=>m(i,"name",{value:t,configurable:!0});var d=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var n=(i,t,e)=>(d(i,t,"read from private field"),e?e.call(i):t.get(i)),o=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)};var r,a,h=class h{constructor(t){o(this,r,"camera;geolocation;fullscreen;gyroscope;accelerometer;magnetometer");o(this,a,"width: 100%; height: 100%;");this.key=t,this.origin=`${window.location.protocol}://${window.location.host}`,this.listen={},this.endpoint="https://app.clicksign.com"}eventsFor(t){let e=t.name||t.data?.name||t.data||t;return this.listen[e]||[]}eventHandler(t){this.eventsFor(t).forEach(e=>e(t.data))}mount(t){return this.target=document.getElementById(t),this.iframe=document.createElement("iframe"),this.iframe.setAttribute("src",this.source),this.iframe.setAttribute("style",n(this,a)),this.iframe.setAttribute("allow",n(this,r)),window.addEventListener("message",e=>this.eventHandler(e)),this.target.appendChild(this.iframe)}on(t,e){return this.listen[t]||(this.listen[t]=[]),this.listen[t].push(e)}unmount(){return this.iframe&&(this.target.removeChild(this.iframe),this.target=null,this.iframe=null,window.removeEventListener("message",this.eventHandler)),!0}get source(){return`${this.endpoint}${this.path}${this.params}`}get params(){return`?embedded=true&origin=${this.origin}`}get path(){return`/notarial/compat/requests/${this.key}`}};r=new WeakMap,a=new WeakMap,l(h,"Clicksign");var s=h;globalThis.Clicksign=s;})();
      </script>
    <link href="./style.css" rel="stylesheet" />
  </head>

  <body>
    <header class="settings closed">
      <h2>⚙️ Configurações</h2>
      <fieldset class="form">
        <div class="field batch-key">
          <label>Request Signature Key</label>
          <input type="text" id="request_signature_key" value="" />
        </div>
        <div class="field enviroment">
          <label>Environment</label>
          <select id="request_enviroment">
            <option value="http://127.0.0.1:3000">Local</option>
            <option value="https://sandbox.clicksign.com">Sandbox</option>
            <option value="https://app.clicksign.com">Produção</option>
          </select>
        </div>

        <div class="action">
          <button id="setButton" type="submit" class="button" onclick="setWidget()">
            Carregar
          </button>

          <button id="removeButton" class="button remove" type="submit" onclick="removeWidget()">
            Remover
          </button>
        </div>

        <div class="options">
          <label for="redirect_option">
            <input type="checkbox" id="redirect_option" /> Ativar redirecionamento ao assinar
          </label>
        </div>
      </fieldset>
    </header>

    <main class="main">
      <div class="loadingText" id="loading" style="display: none">Carregando...</div>

      <div class="container" id="widget" style="display: none; height: 600px;"></div>
    </main>

    <script type="text/javascript">
      let widget,
        signature_request_key_element = document.getElementById('request_signature_key'),
        environment_element = document.getElementById('request_enviroment'),
        redirect_option_element = document.getElementById('redirect_option');
        container_element = document.getElementById('widget');
        loading_element = document.getElementById('loading');

      const ENVIRONMENTS_COUNT = 20;
      for (let index = 1; index <= ENVIRONMENTS_COUNT; index++) {
        let option = document.createElement('option');
        option.text = `Staging ${index}`;
        option.value = `https://${index}.clicksign.dev`;
        environment_element.appendChild(option);
      }

      function debugEvent(event) {
        console.info(`Event: ${event.name || event}`);
        if (event.data) console.table(event.data);
      }

      function setWidget() {
        let request_signature_key = signature_request_key_element.value;

        try {
          if (widget) widget.unmount();

          widget = new Clicksign(request_signature_key);
          widget.endpoint = environment_element.value;
          widget.origin = window.origin;

          widget.mount('widget');

          container_element.style.display = 'none';
          loading_element.style.display = 'block';
        } catch (error) {
          console.log('error:', error);
        } finally {
          loading_element.style.display = 'none';
        }

        widget.on('loaded', function(event) {
          debugEvent(event);

          container_element.style.display = 'block';
        });

        widget.on('signed', function(event) {
          debugEvent(event);
          
          if (redirect_option_element.checked) window.location.assign('https://clicksign.com');
        });

        widget.on('resized', function(event) {
          debugEvent(event);

          container_element.style.height = event.data.height + 'px';
        });

        widget.on('error', function(event) {
          debugEvent(event);

          container_element.style.display = 'block';
        });
      }

      function removeWidget() {
        if (widget) widget.unmount();
      }
    </script>
  </body>
</html>
